<html> 
  <head> 
    <meta http-equiv="content-type" content="text/html;charset=utf-8"> 
    <title>d3.js ~ Calendar View</title> 
    <link type="text/css" rel="stylesheet" href="ex.css?3.2"/>
    <style type="text/css">

#fig {
  width: 960px;
  height: 390px;
}

    </style>
    <script type="text/javascript" src="externals/d3/d3.js?1.11.0"></script> 
    <script type="text/javascript" src="externals/protovis/protovis.min.js"></script> 
    <script type="text/javascript">
    var start = new Date(1990, 0, 1);
	var year = 1000 * 60 * 60 * 24 * 365;
	var data = pv.range(0, 20, .02).map(function(x) {
	    return {x: new Date(start.getTime() + year * x),
	            y: (1 + .1 * (Math.sin(x * 2 * Math.PI))
	                + Math.random() * .1) * Math.pow(1.18, x)
	                + Math.random() * .1};
	  });
	var end = data[data.length - 1].x;
    </script>
   <style type="text/css"> 
 
@import url("css/style.css?1.10.0");
@import url("css/syntax.css?1.6.0");

    </style> 
  </head> 
  <body> 
    <div class="body"> 
      <div class="content"> 
 
<h1 id='calendar_view'>Calendar View</h1> 
<table>
<tr><td>
<div style="width:960px;height:100%;left=0px" id="fig">
<script type="text/javascript+protovis">

/* Scales and sizing. */
var w = 960,
    h1 = 1,
    hmid = 0,
    h2 = 30,
    x = pv.Scale.linear(start, end).range(0, w),
    y = pv.Scale.linear(0, pv.max(data, function(d) d.y)).range(0, h2);

/* Interaction state. Focus scales will have domain set on-render. */
var i = {x:200, dx:100},
    fx = pv.Scale.linear().range(0, w),
    fy = pv.Scale.linear().range(0, h1);

/* Root panel. */
var xvis = new pv.Panel()
    .width(w)
    .height(h1 + hmid + h2)

/* Focus panel (zoomed in). 
var focus = xvis.add(pv.Panel)
    .def("init", function() {
        var d1 = x.invert(i.x),
            d2 = x.invert(i.x + i.dx),
            dd = data.slice(
                Math.max(0, pv.search.index(data, d1, function(d) d.x) - 1),
                pv.search.index(data, d2, function(d) d.x) + 1);
        fx.domain(d1, d2);
        fy.domain([0, pv.max(dd, function(d) d.y)]);
        return dd;
      })
    .top(0)
    .height(h1);


focus.add(pv.Rule)
    .data(function() fx.ticks())
    .left(fx)
    .strokeStyle("#eee")
  .anchor("bottom").add(pv.Label)
    .text(fx.tickFormat);


focus.add(pv.Rule)
    .data(function() fy.ticks(7))
    .bottom(fy)
    .strokeStyle(function(d) d ? "#aaa" : "#000")
  .anchor("left").add(pv.Label)
    .text(fy.tickFormat);

// Focus area chart.
focus.add(pv.Panel)
    .overflow("hidden")
  .add(pv.Area)
    .data(function() focus.init())
    .left(function(d) fx(d.x))
    .bottom(1)
    .height(function(d) fy(d.y))
    .fillStyle("lightsteelblue")
  .anchor("top").add(pv.Line)
    .fillStyle(null)
    .strokeStyle("steelblue")
    .lineWidth(2);
*/
/* Context panel (zoomed out). */
var context = xvis.add(pv.Panel)
    .bottom(0)
    .height(h2);

/* X-axis ticks. */
context.add(pv.Rule)
    .data(x.ticks())
    .left(x)
    .strokeStyle("#eee")
  .anchor("bottom").add(pv.Label)
    .text(x.tickFormat);

/* Y-axis ticks. */
context.add(pv.Rule)
    .bottom(0);

/* Context area chart. */
context.add(pv.Area)
    .data(data)
    .left(function(d) x(d.x))
    .bottom(1)
    .height(function(d) y(d.y))
    .fillStyle("lightsteelblue")
  .anchor("top").add(pv.Line)
    .strokeStyle("steelblue")
    .lineWidth(2);

/* The selectable, draggable focus region. */
context.add(pv.Panel)
    .data([i])
    .cursor("crosshair")
    .events("all")
    .event("mousedown", pv.Behavior.select())
    .event("select", focus)
  .add(pv.Bar)
    .left(function(d) d.x)
    .width(function(d) d.dx)
    .fillStyle("rgba(255, 128, 128, .4)")
    .cursor("move")
    .event("mousedown",pv.Behavior.drag()/*(function(){ 
                          var callee=pv.Behavior.drag();
                          return function(e) {
                             callee(e);
                          }
                        })()*/)
    .event("drag", focus);

xvis.render();
  	    </script>
</div>
</td></tr><tr><td>
<div class='gallery' id='gallery_chart'> </div><link href='externals/d3/examples/calendar/calendar.css' rel='stylesheet' type='text/css' /><link href='externals/d3/lib/colorbrewer/colorbrewer.css' rel='stylesheet' type='text/css' /><script src='externals/d3/d3.csv.js?1.11.0' type='text/javascript'> </script><script src='externals/d3/d3.time.js?1.11.0' type='text/javascript'> </script><script src='calendar.js' type='text/javascript'> </script><script src='dji.js' type='text/javascript'> </script> 
</td></tr></table>
  </body> 
</html> 
